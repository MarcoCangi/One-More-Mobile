<div class="container content">
  <ion-spinner *ngIf="isLoading" name="crescent" color="primary"></ion-spinner>

<h4 class="ion-title">Inserisci i dati della tua attività</h4>

  <form>
    <div class="row">
      <div class="col-md-6 formInput">
        <app-nome [nome]="this.attivita?.nome" (nomeChange)="handleNomeChange($event)"></app-nome>
        <mat-error *ngIf="this.errorNome && !this.requestAttivita?.nome" class="err">
          {{this.errorNome}}
        </mat-error>
      </div>
      <div class="col-md-6 formInput">
        <app-telefono [telefono]="this.attivita?.telefono" (telefonoChange)="handleTelefonoChange($event)"></app-telefono>
        <mat-error *ngIf="this.errorTel" class="err">
          {{this.errorTel}}
        </mat-error>
      </div>
    </div>
    <div class="row">
    <div class="formInput">
      <ng-container *ngIf="this.idAttivita === 0 || this.attivita?.listaTipoAttivita">
        <app-tipo-attivita [listaAttivitaDDL]="listaAttivitaDDL" [listaAttivitaSelezionate]="this.attivita?.listaTipoAttivita" (listaAttivitaChanged)="handleListaTipoAttivitaChange($event)"></app-tipo-attivita>
        <mat-error *ngIf="this.errorTipologia && (!this.requestAttivita?.listaTipoAttivita || this.requestAttivita?.listaTipoAttivita?.length === 0)" class="err">
          {{this.errorTipologia}}
        </mat-error>
      </ng-container>
    </div>
      <div class="formInput">
        <app-cellulare [cellulare]="this.attivita?.cellulare" [isPubblico]="this.attivita?.isCellPubblico" (cellulareChange)="handleCellulareChange($event)" (isCellPubblicoChange)="handleIsCellPubblicoeChange($event)"></app-cellulare>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 formInput">
        <app-citta [listaComuni]="listaComuni" [citta]="this.attivita?.citta" (cittaChange)="handleCittaChange($event)"></app-citta>
        <mat-error *ngIf="this.errorCitta || !this.requestAttivita?.citta" class="err">
          {{this.errorCitta}}
        </mat-error>
      </div>
      <div class="formInput">
        <app-email [email]="attivita?.email" (emailChange)="handleEmailChange($event)"></app-email>
        <mat-error *ngIf="this.errorEmail && !this.requestAttivita?.email" class="err">
          {{this.errorEmail}}
        </mat-error>
      </div>
      <div class="row">
      <div class="formInput">
        <app-indirizzo [indirizzo]="this.attivita?.indirizzo" (indirizzoChange)="handleIndirizzoChange($event)"></app-indirizzo>
        <mat-error *ngIf="this.errorIndirizzo || !this.requestAttivita?.indirizzo" class="err">
          {{this.errorIndirizzo}}
        </mat-error>
      </div>
      <div class="formInput">
        <app-civico [civico]="this.attivita?.civico" (civicoChange)="handleCivicoChange($event)"></app-civico>
        <mat-error *ngIf="this.errorCivico || !this.requestAttivita?.civico" class="err">
          {{this.errorCivico}}
        </mat-error>
      </div>
      <div class="formInput">
        <app-cap [cap]="this.attivita?.cap" (capChange)="handleCapChange($event)"></app-cap>
        <mat-error *ngIf="this.errorCAP || !this.requestAttivita?.cap" class="err">
          {{this.errorCAP}}
        </mat-error>
      </div>
      <div class="formInput">
      <app-orari-apertura name="orari" [orari]="this.attivita?.orari"  (orariChange)="handleOrariChange($event)"></app-orari-apertura>
      </div>
      <div class="row">
        <div class="col-md-16">
          <div class="col-md-16 formInput">
            <app-offerte-struttura 
              [isVegano]="attivita?.isOffertaVegana" 
              [isVegetariano]="attivita?.isOffertaVegetariana" 
              [isNoGlutine]="attivita?.isOffertaNoGlutine"
              (offertaVeganaChange)="handleIsOffertaVeganaChange($any($event))"
              (offertaNoGlutineChange)="handleIsOffertaNoGlutineChange($any($event))"
              (offertaVegetarianaChange)="handleIsOffertaVegetarianaChange($any($event))">
            </app-offerte-struttura>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-container *ngIf="this.idAttivita === 0 || this.attivita?.immagini">
    <app-gallery name="gallery" [immagini]="this.attivita?.immagini" (immaginiChange)="handleImmaginiChange($event)"></app-gallery>
    <mat-error *ngIf="this.errorImg && !this.requestAttivita?.immagini" class="err">
      {{this.errorImg}}
    </mat-error>
  </ng-container>
  <div class="col-md-16 formInput">
  <app-menu name="descMenu" [descrizione]="this.attivita?.descrizione" 
                            (descrizioneChange)="handleDescChange($event)"
                            [descrizioneOfferta]="this.attivita?.descrizioneOfferta" 
                            (descrizioneOffertaChange)="handleDescOffertaChange($event)"></app-menu>
  </div>
  </form>
  
  <div class="prosegui">
        <ion-button (click)="prosegui()">Prosegui</ion-button>
  </div>


  <ion-modal [isOpen]="isDetailModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Lista delle Attività</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-card>
          <ion-card-header>
            <ion-card-title *ngIf="this.isSalvataggioOK"> Salvataggio eseguito correttamente </ion-card-title>
            <ion-card-title *ngIf="!this.isSalvataggioOK"> OPS qualcosa è andato storto </ion-card-title>
          </ion-card-header>
          <ion-card-content style="display: flex; justify-content: center; align-items: center; margin-top: 1%;">
            <ion-button shape="round" (click)="dismissDetailModal">CHIUDI</ion-button>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
