<ion-spinner *ngIf="isLoading" name="crescent" color="primary"></ion-spinner>

<div *ngIf="!this.isLoading">
  <div class="container-msgErr">
    <h4 *ngIf="this.msgErr" class="msgErr">{{msgErr}}</h4>
  </div>
  <ion-title style="margin-top: 8%; margin-bottom: 3%;">Inserisci la tua promozione</ion-title>
  <form>
    <div class="row">
      <div class="formInput">
        <app-titolo [titolo]="this.modificaPromo.titoloPromo" (titoloChange)="handleTitoloChange($event)"></app-titolo>
      </div>
      <div class="formInput">
        <app-periodo-validita [dataDalValue]="this.modificaPromo.dataDal"
                              [dataAlValue]="this.modificaPromo.dataAl"
                              (dataDalChange)="handleDataDalChange($event)" 
                              (dataAlChange)="handleDataAlChange($event)"></app-periodo-validita>
      </div>
    </div>
    <div class="row">
      <div class="formInput">
        <app-descrizione [descrizione]="this.modificaPromo.descPromo" 
                         (descrizioneChange)="handleDescChange($event)"></app-descrizione>
      </div>
      <div class="formInput">
        <app-giorni-validita [giorni]="this.giorni" 
                             (isAllSettimanaChange)="handleAllSettimanaChange($event)"
                             (isLunediChange)="handleLunediChange($event)"
                             (isMartediChange)="handleMartediChange($event)"
                             (isMercolediChange)="handleMercolediChange($event)"
                             (isGiovediChange)="handleGiovediChange($event)"
                             (isVenerdiChange)="handleVenerdiChange($event)"
                             (isSabatoChange)="handleSabatoChange($event)"
                             (isDomenicaChange)="handleDomenicaChange($event)"></app-giorni-validita>
      </div>
      <div class="row">
      <div class="formInput">
        <app-orario-validita [isAllDayValidita]="this.modificaPromo.isAllDayValidita"
                             [orarioValiditaDa]="this.modificaPromo.orarioValiditaDa"
                             [orarioValiditaAl]="this.modificaPromo.orarioValiditaAl"
                             (isAllDayValiditaChange)="handleIsAllDayValiditaChange($event)"
                             (orarioValiditaDaChange)="handleOrarioValiditaDaChange($event)"
                             (orarioValiditaAlChange)="handleorarioValiditaAlChange($event)"></app-orario-validita>
      </div>
      <div class="formInput">
      <app-tipologia-offerta [listaTipologieSelezionate]="this.listaTipologie"
                             (listaTipologieChanged)="handleListaTipologieChange($event)"></app-tipologia-offerta>
      </div>
      </div>
    </div>
    <div class="formInput">
      <div>
        <ion-label>Vuoi mettere un limite di utilizzi?</ion-label>
        <ion-toggle style="margin-left: 5%;" [(ngModel)]="isLimitEnabled" [ngModelOptions]="{standalone: true}" ></ion-toggle>
      </div>
  </div>
  <div class="formInput divNumMaxCoupon" *ngIf="isLimitEnabled" >
    <div>
      <app-num-max-coupon [numMax]="this.modificaPromo.numCouponMax" (numMaxChange)="handleNumMaxChange($event)"></app-num-max-coupon>
    </div>
  </div>
  <div class="formInput divCouponPerPersona" *ngIf="isLimitEnabled">
    <div>
      <app-coupon-per-persona [numMaxPerPersona]="this.modificaPromo.numUtilizziPerPersonaMax" 
                              (numMaxPerPersonaChange)="handleNumMaxPerPersonaChange($event)"></app-coupon-per-persona>
    </div>
  </div>
  </form>
  
  <div class="container" style="margin-bottom: 10%;">
    <div class="row" *ngIf="!this.modificaPromo.idPromo">
        <div class="col-5"></div>
        <div class="col-3"><ion-button shape="round" (click)="salva()">Salva</ion-button></div>
        <div class="col-4"></div>
    </div>
    <div class="row" *ngIf="this.modificaPromo.idPromo">
      <div class="col-5"></div>
      <div class="col-3"><ion-button shape="round" (click)="modifica()">Modifica</ion-button></div>
      <div class="col-4"></div>
  </div>
  </div>
</div>