
<div *ngFor="let promo of listaPromo" style="width: 400; margin-bottom: 25px;">

  <!-- icone tipo promo -->
  <div class="typePromo-overlay">
      <div class="icona-promo-container" *ngIf="has2X1Tipologia(promo)" (click)="showAlert('2X1', 'Promozione 2x1 disponibile')">
  <img class="icona-promo dueperuno" src="assets/Img/2x1_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasOmaggiTipologia(promo)" (click)="showAlert('Omaggi', 'Promozione che prevede omaggi')">
  <img class="icona-promo gift" src="assets/Img/gift 2_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasPacchettiTipologia(promo)" (click)="showAlert('Pacchetti', 'Sono disponibili pacchetti promozionali')">
  <img class="icona-promo bundle" src="assets/Img/scatola_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasScontiTipologia(promo)" (click)="showAlert('Sconti', 'Sono disponibili sconti esclusivi')">
  <img class="icona-promo percent" src="assets/Img/percentuale_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasPerBambiniTipologia(promo)" (click)="showAlert('Per bambini', 'Offerte pensate per i piÃ¹ piccoli')">
  <img class="icona-promo child" src="assets/Img/bambini_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasPerFamiglieTipologia(promo)" (click)="showAlert('Per famiglie', 'Promozioni adatte alle famiglie')">
  <img class="icona-promo family" src="assets/Img/ticket famiglia_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasPerCoppieTipologia(promo)" (click)="showAlert('Per coppie', 'Offerte romantiche per due')">
  <img class="icona-promo love" src="assets/Img/love_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasVeganiTipologia(promo)" (click)="showAlert('Vegani', 'Offerte adatte a chi segue una dieta vegana')">
  <img class="icona-promo vegan" src="assets/Img/vegano_Ar.png" />
</div>

<div class="icona-promo-container" *ngIf="hasVegetarianiTipologia(promo)" (click)="showAlert('Vegetariani', 'Offerte adatte a chi segue una dieta vegetariana')">
  <img class="icona-promo vegan" src="assets/Img/vegetariano_Ar.png" />
</div>

      <div class="ends-container">
          <ion-note style="color: black; font-size: 0.8rem; margin-left: 12px;">{{'EndsOn'|translate}} {{ promo.dataAl | date:'dd-MM-yyyy' }}</ion-note>
      </div>
  </div>
  
  <ion-card class="card-promo">
    <!-- CHIP POSIZIONATO IN ALTO A DESTRA -->
    <ion-chip class="chip-rimanenti" *ngIf="promo.numCouponRimanenti && promo.numCouponRimanenti < 50">
      <ion-icon name="time-outline" style="margin-right: 4px;" color="white"></ion-icon>
      <ion-label>Solo {{ promo.numCouponRimanenti }} rimanenti!</ion-label>
    </ion-chip>
    <ion-card-header>
      <ion-card-title class="titlePromo">
        {{promo.titoloPromo}}
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-card-subtitle>
        {{promo.descPromo}}
      </ion-card-subtitle>
      <hr class="promo-divider" />
      <div class="sezione-periodo">
        <div class="chip-periodo-wrapper">
          <ion-label class="lbl">{{'PerfectFor' | translate}}</ion-label>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('1')">
            <ion-label>{{'BREAKFAST' | translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('2')">
            <ion-label>{{'Brunch' | translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('3')">
            <ion-label>{{'LUNCH' | translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('4')">
            <ion-label>{{'AfternoonTea'|translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('5')">
            <ion-label>{{'HappyHour' | translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('6')">
            <ion-label>{{'DINNER'|translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('7')">
            <ion-label>{{'LATENIGHT'|translate}}</ion-label>
          </ion-chip>
          <ion-chip class="chip-periodo" *ngIf="promo.periodo?.includes('8')">
            <ion-label>{{'ANYTIME'|translate}}</ion-label>
          </ion-chip>
        </div>
      </div>
      <hr class="promo-divider" />
      <div class="lblContainer">
        <ion-label class="lbl">{{ 'VALID_TIMEDAYS' | translate }} : </ion-label>
        <ion-label class="lbl" *ngIf="promo.isAllDayValidita">{{ 'ALL_DAY' | translate }}</ion-label>
        <ion-label class="lbl" *ngIf="!promo.isAllDayValidita">{{ 'FROM' | translate }} {{ promo.orarioValiditaDa }} - {{ 'TO' | translate }} {{ promo.orarioValiditaAl }}</ion-label>
      </div>
      <ion-grid>
              <ion-row>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'MON'|translate}}</ion-label>
                  </ion-col>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'TUE'|translate}}</ion-label>
                  </ion-col>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'WED'|translate}}</ion-label>
                  </ion-col>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'THU'|translate}}</ion-label>
                  </ion-col>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'FRI'|translate}}</ion-label>
                  </ion-col>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'SAT'|translate}}</ion-label>
                  </ion-col>
                  <ion-col class="column ion-text-center ion-align-items-center">
                    <ion-label class="labelDays">{{'SUN'|translate}}</ion-label>
                  </ion-col>
              </ion-row>
              <ion-row style="margin-top: -10px; height: 20px">
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(1) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(1) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>
                </ion-col>
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(2) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(2) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>

                </ion-col>
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(3) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(3) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>
                </ion-col>
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(4) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(4) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>
                </ion-col>
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(5) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(5) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>
                </ion-col>
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(6) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(6) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>
                </ion-col>
                <ion-col class="column ion-text-center ion-align-items-center">
                  <ion-label *ngIf="promo.days?.includes(7) || promo.days?.includes(0)"><ion-icon color="success" style="height: 22px; width: 22px;" name="checkmark-outline"></ion-icon></ion-label>
                  <ion-label *ngIf="!promo.days?.includes(7) && !promo.days?.includes(0)"><ion-icon color="danger" style="height: 22px; width: 22px;" name="close-outline"></ion-icon></ion-label>
                </ion-col>
            </ion-row>
      </ion-grid>
      <hr class="promo-divider" />
      <div style="height: 40px;">

      </div>
      
    </ion-card-content>
  </ion-card>
  <ion-button style="margin-top: -55px;  width: 80%; margin-left: 10%;" expand="block" shape="round" (click)="openConfirmModal(promo)">{{'Reserve'|translate}}</ion-button>
</div>
<ion-modal [isOpen]="isModalConfirmOpen" class="full-modal">
  <ng-template>

    <ion-header *ngIf="isLoading">
      <ion-spinner  name="crescent" color="primary"></ion-spinner>
    </ion-header>

    <ion-content class="column ion-text-center ion-align-items-center">
      <div class="center-div">

        <ion-card class="confirm-card" *ngIf="!isLoading && !isConfirmed">
          <ion-card-header class="confirm-header">
            <ion-card-title class="confirm-title" *ngIf="!isError">
              {{ 'AlmostThere' | translate }}
            </ion-card-title>
            <ion-card-subtitle class="confirm-subtitle" *ngIf="!isError">
              {{ 'AboutAcquireCoupon' | translate }}
            </ion-card-subtitle>
            <ion-card-title class="confirm-title" *ngIf="isError">
              {{ 'SAVE_ERROR' | translate }}
            </ion-card-title>
          </ion-card-header>
        
          <div class="confirm-icon-wrapper" *ngIf="!isError">
            <img class="confirm-icon" src="assets/Img/spunta_vicino.png" alt="ok">
          </div>
          <div class="confirm-icon-wrapper" *ngIf="isError">
            <img class="confirm-icon error" src="assets/Img/not_okay.png" alt="error">
          </div>
        
          <!-- Stato normale -->
          <ion-card-content *ngIf="!isError">
            <div class="actions">
              <ion-button expand="block" shape="round" (click)="Prenota()">
                {{ 'CONFIRM' | translate }}
              </ion-button>
              <ion-button expand="block" shape="round" fill="outline" color="medium" (click)="dismissConfirmModal(0)">
                {{ 'CANCEL' | translate }}
              </ion-button>
            </div>
          </ion-card-content>
        
          <!-- Stato errore -->
          <ion-card-content *ngIf="isError">
            <div class="actions single">
              <ion-label class="error-label">{{this.errorMessage}}</ion-label>
              <ion-button expand="block" shape="round" fill="outline" color="medium" (click)="dismissConfirmModal(0)">
                {{ 'CLOSE' | translate }}
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="success-card" *ngIf="!isLoading && isConfirmed" role="status" aria-live="polite">
          <ion-card-header class="success-header">
            <ion-card-title class="success-title">
              {{ 'PROMOISUP' | translate }}
              <ion-icon class="info-icon" name="alert-circle-outline"></ion-icon>
            </ion-card-title>
          </ion-card-header>
        
          <div class="confirm-icon-wrapper">
            <img class="confirm-icon" src="assets/Img/spunta_okay.png" alt="Promo attiva">
          </div>
        
          <ion-card-content>
            <p class="success-info">
              {{ 'PromoIsUpDetail' | translate }}
            </p>
          
            <div class="actions">
              <ion-button expand="block" shape="round" (click)="dismissConfirmModal(1)">
                <ion-icon slot="start" name="ticket-outline"></ion-icon>
                {{ 'Coupon' | translate }}
              </ion-button>
            
              <ion-button expand="block" shape="round" fill="outline" color="medium" (click)="dismissConfirmModal(2)">
                <ion-icon slot="start" name="home-outline"></ion-icon>
                {{ 'Home' | translate }}
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>

      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="isModalVerifiedOpen" class="full-modal">
  <ng-template>
    <ion-content class="column ion-text-center ion-align-items-center">
      <ion-card>
        <ion-card-header>
          <ion-card-title class="subTitle">
            {{'CompleteVerificationToCoupon'|translate}}
          </ion-card-title>
        </ion-card-header>
        <ion-card-content class="column ion-text-center ion-align-items-center">
          <ion-button (click)="dismissisModalVerified()">{{'CLOSE'|translate}}</ion-button>
          <br>
          <br>
          <ion-label *ngIf="!esitoResendVerification">({{'Didnt get the email'|translate}})</ion-label>
          <ion-label *ngIf="esitoResendVerification" style="font-weight: bold;">{{esitoResendVerification}}</ion-label>
          <br>
          <br>
          <ion-label color="primary" (click)="resendVerificationEmail()">{{'Resend verification email'|translate}}</ion-label>
        </ion-card-content>
      </ion-card>
    </ion-content>
  </ng-template>
</ion-modal>